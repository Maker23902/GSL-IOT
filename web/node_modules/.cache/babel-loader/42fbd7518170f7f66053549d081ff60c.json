{"remainingRequest":"D:\\Program Files\\Microsoft VS Code\\Myproject\\GSL-IOT\\web\\node_modules\\babel-loader\\lib\\index.js!D:\\Program Files\\Microsoft VS Code\\Myproject\\GSL-IOT\\web\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\Program Files\\Microsoft VS Code\\Myproject\\GSL-IOT\\web\\src\\utils\\lorarequest.js","dependencies":[{"path":"D:\\Program Files\\Microsoft VS Code\\Myproject\\GSL-IOT\\web\\src\\utils\\lorarequest.js","mtime":1605791078185},{"path":"D:\\Program Files\\Microsoft VS Code\\Myproject\\GSL-IOT\\web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1605791053029},{"path":"D:\\Program Files\\Microsoft VS Code\\Myproject\\GSL-IOT\\web\\node_modules\\babel-loader\\lib\\index.js","mtime":1605791047245},{"path":"D:\\Program Files\\Microsoft VS Code\\Myproject\\GSL-IOT\\web\\node_modules\\eslint-loader\\index.js","mtime":1605791057309}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7IC8vIOW8leWFpWF4aW9zCgppbXBvcnQgeyBNZXNzYWdlLCBMb2FkaW5nIH0gZnJvbSAnZWxlbWVudC11aSc7CmltcG9ydCB7IHN0b3JlIH0gZnJvbSAnQC9zdG9yZS9pbmRleCc7CnZhciBsb3JhU2VydmVyU2VydmljZSA9IGF4aW9zLmNyZWF0ZSh7CiAgYmFzZVVSTDogcHJvY2Vzcy5lbnYuVlVFX0FQUF9MU0JBU0VfQVBJLAogIHRpbWVvdXQ6IDk5OTk5Cn0pOwp2YXIgYWNpdHZlQXhpb3MgPSAwOwp2YXIgbG9hZGluZ0luc3RhbmNlOwp2YXIgdGltZXI7Cgp2YXIgc2hvd0xvYWRpbmcgPSBmdW5jdGlvbiBzaG93TG9hZGluZygpIHsKICBhY2l0dmVBeGlvcysrOwoKICBpZiAodGltZXIpIHsKICAgIGNsZWFyVGltZW91dCh0aW1lcik7CiAgfQoKICB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgaWYgKGFjaXR2ZUF4aW9zID4gMCkgewogICAgICBsb2FkaW5nSW5zdGFuY2UgPSBMb2FkaW5nLmxvcmFTZXJ2ZXJTZXJ2aWNlKHsKICAgICAgICBmdWxsc2NyZWVuOiB0cnVlCiAgICAgIH0pOwogICAgfQogIH0sIDQwMCk7Cn07Cgp2YXIgY2xvc2VMb2FkaW5nID0gZnVuY3Rpb24gY2xvc2VMb2FkaW5nKCkgewogIGFjaXR2ZUF4aW9zLS07CgogIGlmIChhY2l0dmVBeGlvcyA8PSAwKSB7CiAgICBjbGVhclRpbWVvdXQodGltZXIpOwogICAgbG9hZGluZ0luc3RhbmNlICYmIGxvYWRpbmdJbnN0YW5jZS5jbG9zZSgpOwogIH0KfTsgLy9odHRwIHJlcXVlc3Qg5oum5oiq5ZmoCgoKbG9yYVNlcnZlclNlcnZpY2UuaW50ZXJjZXB0b3JzLnJlcXVlc3QudXNlKGZ1bmN0aW9uIChjb25maWcpIHsKICBzaG93TG9hZGluZygpOwogIHZhciB0bXAgPSBzdG9yZS5nZXR0ZXJzWyd1c2VyL0xTdG9rZW4nXTsKCiAgaWYgKHRtcCAhPSAnJykgewogICAgdG1wID0gIkJlYXJlciAiICsgdG1wOwogIH0KCiAgdmFyIHRva2VuID0gdG1wOyAvLyBjb25zdCB1c2VyID0gc3RvcmUuZ2V0dGVyc1sndXNlci91c2VySW5mbyddICAgICAKCiAgY29uZmlnLmRhdGEgPSBKU09OLnN0cmluZ2lmeShjb25maWcuZGF0YSk7CiAgY29uZmlnLmhlYWRlcnMgPSB7CiAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgLy8neC10b2tlbic6IHRva2VuLAogICAgJ0dycGMtTWV0YWRhdGEtQXV0aG9yaXphdGlvbic6IHRva2VuIC8vICd4LXVzZXItaWQnOiB1c2VyLklECgogIH07CiAgcmV0dXJuIGNvbmZpZzsKfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgY2xvc2VMb2FkaW5nKCk7CiAgTWVzc2FnZSh7CiAgICBzaG93Q2xvc2U6IHRydWUsCiAgICBtZXNzYWdlOiBlcnJvciwKICAgIHR5cGU6ICdlcnJvcicKICB9KTsKICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwp9KTsgLy9odHRwIHJlc3BvbnNlIOaLpuaIquWZqAoKbG9yYVNlcnZlclNlcnZpY2UuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICBjbG9zZUxvYWRpbmcoKTsgLy8gaWYocmVzcG9uc2UuZGF0YS5jb2RlID09PSB1bmRlZmluZWQpewogIC8vICAgICBjb25zb2xlLmxvZyhyZXNwb25zZS5kYXRhKTsKICAvLyAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGEKICAvLyB9CgogIGlmIChyZXNwb25zZS5kYXRhWyJqd3QiXSkgewogICAgc3RvcmUuY29tbWl0KCd1c2VyL1NldExTdG9rZW4nLCByZXNwb25zZS5kYXRhWyJqd3QiXSk7CiAgfQoKICBpZiAocmVzcG9uc2UuZGF0YS5jb2RlID09PSB1bmRlZmluZWQgfHwgcmVzcG9uc2UuaGVhZGVycy5zdWNjZXNzID09PSAidHJ1ZSIpIHsKICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogIH0gZWxzZSB7CiAgICBNZXNzYWdlKHsKICAgICAgc2hvd0Nsb3NlOiB0cnVlLAogICAgICBtZXNzYWdlOiByZXNwb25zZS5kYXRhLm1zZyB8fCBkZWNvZGVVUkkocmVzcG9uc2UuaGVhZGVycy5tc2cpLAogICAgICB0eXBlOiAnZXJyb3InCiAgICB9KTsKCiAgICBpZiAocmVzcG9uc2UuZGF0YS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuZGF0YS5yZWxvYWQpIHsKICAgICAgc3RvcmUuY29tbWl0KCd1c2VyL0xvZ2luT3V0Jyk7CiAgICB9CgogICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlc3BvbnNlLmRhdGEubXNnKTsKICB9Cn0sIGZ1bmN0aW9uIChlcnJvcikgewogIGNsb3NlTG9hZGluZygpOwogIE1lc3NhZ2UoewogICAgc2hvd0Nsb3NlOiB0cnVlLAogICAgbWVzc2FnZTogZXJyb3IsCiAgICB0eXBlOiAnZXJyb3InCiAgfSk7CiAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKS5jYXRjaChmdW5jdGlvbiAoZSkge30pOwp9KTsKZXhwb3J0IGRlZmF1bHQgbG9yYVNlcnZlclNlcnZpY2U7"},{"version":3,"sources":["D:/Program Files/Microsoft VS Code/Myproject/GSL-IOT/web/src/utils/lorarequest.js"],"names":["axios","Message","Loading","store","loraServerService","create","baseURL","process","env","VUE_APP_LSBASE_API","timeout","acitveAxios","loadingInstance","timer","showLoading","clearTimeout","setTimeout","fullscreen","closeLoading","close","interceptors","request","use","config","tmp","getters","token","data","JSON","stringify","headers","error","showClose","message","type","Promise","reject","response","commit","code","undefined","success","msg","decodeURI","reload","catch","e"],"mappings":"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","sourcesContent":["import axios from 'axios'; // 引入axios\r\nimport { Message, Loading } from 'element-ui';\r\nimport { store } from '@/store/index'\r\nconst loraServerService = axios.create({\r\n    baseURL: process.env.VUE_APP_LSBASE_API,\r\n    timeout: 99999\r\n})\r\nlet acitveAxios = 0\r\nlet loadingInstance\r\nlet timer\r\nconst showLoading = () => {\r\n    acitveAxios++\r\n    if (timer) {\r\n        clearTimeout(timer)\r\n    }\r\n    timer = setTimeout(() => {\r\n        if (acitveAxios > 0) {\r\n            loadingInstance = Loading.loraServerService({ fullscreen: true })\r\n        }\r\n    }, 400);\r\n}\r\n\r\nconst closeLoading = () => {\r\n        acitveAxios--\r\n        if (acitveAxios <= 0) {\r\n            clearTimeout(timer)\r\n            loadingInstance && loadingInstance.close()\r\n        }\r\n    }\r\n    //http request 拦截器\r\nloraServerService.interceptors.request.use(\r\n    config => {\r\n        showLoading()\r\n        var tmp = store.getters['user/LStoken']\r\n        if(tmp!=''){\r\n            tmp = \"Bearer \"+tmp\r\n        }\r\n        const token = tmp\r\n        // const user = store.getters['user/userInfo']     \r\n        config.data = JSON.stringify(config.data);\r\n\r\n        config.headers = {\r\n            'Content-Type': 'application/json',\r\n            //'x-token': token,\r\n            'Grpc-Metadata-Authorization':token,\r\n            // 'x-user-id': user.ID\r\n        }\r\n        return config;\r\n    },\r\n    error => {\r\n        closeLoading()\r\n        Message({\r\n            showClose: true,\r\n            message: error,\r\n            type: 'error'\r\n        })\r\n        return Promise.reject(error);\r\n    }\r\n);\r\n\r\n\r\n//http response 拦截器\r\nloraServerService.interceptors.response.use(\r\n    response => {\r\n        closeLoading()\r\n        // if(response.data.code === undefined){\r\n        //     console.log(response.data);\r\n        //     return response.data\r\n        // }\r\n        if (response.data[\"jwt\"]) {\r\n            store.commit('user/SetLStoken', response.data[\"jwt\"])\r\n        }\r\n        if (response.data.code === undefined || response.headers.success === \"true\") {\r\n            return response.data\r\n        } else {\r\n            Message({\r\n                showClose: true,\r\n                message: response.data.msg || decodeURI(response.headers.msg),\r\n                type: 'error',\r\n            })\r\n            if (response.data.data && response.data.data.reload) {\r\n                store.commit('user/LoginOut')\r\n            }\r\n            return Promise.reject(response.data.msg)\r\n        }\r\n    },\r\n    error => {\r\n        closeLoading()\r\n        Message({\r\n            showClose: true,\r\n            message: error,\r\n            type: 'error'\r\n        })\r\n        return Promise.reject(error).catch((e)=>{})\r\n    }\r\n)\r\n\r\nexport default loraServerService"]}]}